name: ç¼–è¯‘å¹¶å‘å¸ƒ SPRDClient

on:
  # æ‰‹åŠ¨è§¦å‘ï¼ˆå¯é€‰è¾“å…¥ç‰ˆæœ¬å·ï¼‰
  workflow_dispatch:
    inputs:
      version:
        description: 'ç‰ˆæœ¬å·ï¼ˆå¦‚ v1.3.0ï¼Œç•™ç©ºåˆ™ä»…ç¼–è¯‘ä¸å‘å¸ƒ Releaseï¼‰'
        required: false
        type: string
  
  # æ¨é€ tag æ—¶è‡ªåŠ¨è§¦å‘
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    # 1. æ£€å‡º SPRDClient ä¸»ä»“åº“
    - name: æ£€å‡º SPRDClient ä»“åº“
      uses: actions/checkout@v4
      with:
        path: SPRDClient
    
    # 2. æ£€å‡º SPRDClientCore æ ¸å¿ƒåº“åˆ°æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„
    - name: æ£€å‡º SPRDClientCore ä»“åº“
      uses: actions/checkout@v4
      with:
        repository: RockerHX/SPRDClientCore
        path: SPRDClientCore
    
    # 3. è®¾ç½® .NET 8.0 SDK
    - name: å®‰è£… .NET 8.0
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    
    # 4. è¿˜åŸ NuGet åŒ…
    - name: è¿˜åŸä¾èµ–åŒ…
      run: dotnet restore SPRDClient/SPRDClient.sln
    
    # 5. ç¼–è¯‘é¡¹ç›®ï¼ˆRelease é…ç½®ï¼‰
    - name: ç¼–è¯‘é¡¹ç›®
      run: dotnet build SPRDClient/SPRDClient.sln --configuration Release --no-restore
    
    # 6. å‘å¸ƒè‡ªåŒ…å«åº”ç”¨ç¨‹åºï¼ˆç”Ÿæˆç‹¬ç«‹ exeï¼‰
    - name: å‘å¸ƒåº”ç”¨ç¨‹åº
      run: |
        dotnet publish SPRDClient/SPRDClient.csproj `
          --configuration Release `
          --runtime win-x64 `
          --self-contained true `
          --output ./publish `
          -p:PublishSingleFile=true `
          -p:IncludeNativeLibrariesForSelfExtract=true `
          -p:EnableCompressionInSingleFile=true
    
    # 7. å‹ç¼©å‘å¸ƒæ–‡ä»¶ä¸º zip
    - name: å‹ç¼©å‘å¸ƒæ–‡ä»¶
      run: Compress-Archive -Path ./publish/* -DestinationPath SPRDClient-windows-x64.zip
    
    # 8. ä¸Šä¼ ç¼–è¯‘äº§ç‰©ï¼ˆæ‰€æœ‰æ„å»ºéƒ½ä¸Šä¼ ï¼Œä¿ç•™ 30 å¤©ï¼‰
    - name: ä¸Šä¼ æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: SPRDClient-windows-x64
        path: SPRDClient-windows-x64.zip
        retention-days: 30
    
    # 9. åˆ›å»º GitHub Releaseï¼ˆä»…å½“æœ‰ç‰ˆæœ¬å·æ—¶ï¼‰
    - name: åˆ›å»º GitHub Release
      if: github.event.inputs.version != '' || startsWith(github.ref, 'refs/tags/')
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ github.event.inputs.version || github.ref_name }}
        name: SPRDClient ${{ github.event.inputs.version || github.ref_name }}
        artifacts: "SPRDClient-windows-x64.zip"
        body: |
          ## ğŸ“¦ SPRDClient Windows ç‰ˆæœ¬
          
          å±•è®¯ï¼ˆUnisoc/Spreadtrumï¼‰è®¾å¤‡åˆ·æœºå·¥å…· Windows å®¢æˆ·ç«¯
          
          ### ğŸ“¥ ä¸‹è½½è¯´æ˜
          1. ä¸‹è½½ `SPRDClient-windows-x64.zip` å¹¶è§£å‹
          2. è¿è¡Œ `SPRDClient.exe` å³å¯ä½¿ç”¨
          3. **æ— éœ€å®‰è£… .NET è¿è¡Œæ—¶**ï¼ˆè‡ªåŒ…å«å‘å¸ƒï¼‰
          
          ### âœ¨ åŠŸèƒ½ç‰¹æ€§
          - âœ… æ”¯æŒå±•è®¯è®¾å¤‡ Brom/Fdl1/Fdl2 é˜¶æ®µé€šä¿¡
          - âœ… æ”¯æŒå‘é€ FDL æ–‡ä»¶åˆ°æŒ‡å®šåœ°å€
          - âœ… æ”¯æŒè¯»å†™è®¾å¤‡åˆ†åŒº
          - âœ… æ”¯æŒæ—  FDL åˆ·æœºæ¨¡å¼
          - âœ… æ”¯æŒé‡è¿æ¨¡å¼
          - âœ… ç°ä»£åŒ– Fluent Design ç•Œé¢
          
          ### ğŸ“ ä½¿ç”¨è¯´æ˜
          è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹é¡¹ç›® README æ–‡æ¡£
          
          ### ğŸ‘¥ ä½œè€…
          YC & la1N
          
          ---
          ğŸ”§ ç¼–è¯‘ç¯å¢ƒï¼šWindows Server 2022 + .NET 8.0  
          ğŸ“… å‘å¸ƒæ—¶é—´ï¼š${{ github.event.repository.updated_at }}
